"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : {"default": mod};
};
Object.defineProperty(exports, "__esModule", {value: true});
const fs_extra_1 = __importDefault(require("fs-extra"));

class JsonStudentRepository {
    constructor(path = './src/persistence/data/students.json') {
        this.path = path;
    }

    getAllStudents() {
        return fs_extra_1.default.readJson(this.path)
            .catch((error) = > console.log(error.message)
    )
        ;
    }

    getStudentById(id) {
        return this.getAllStudents()
            .then((students) = > students.find((student) = > student.id === id
    ))
        ;
    }

    createStudent(postedStudent) {
        const id = postedStudent.id;
        return this.getStudentById(id)
            .then(student = > {
            if(student)
            throw new Error("student already exists.");
    else
        return this._save(postedStudent);
    })
        ;
    }

    updateStudent(postedStudent) {
        const id = postedStudent.id;
        return this.getAllStudents()
            .then(students = > {
            if(students.length !== 0
    )
        return students;
    else
        throw new Error("students do not exist.");
    })
    .
        catch(error = > {throw new Error(error.message);
    })
    .
        then(students = > {
            if(students.some(student = > student.id === id
    ))
        return [...students.filter(student = > student.id !== id
    )]
        ;
    else
        throw new Error("student does not exist.");
    })
    .
        catch(error = > {throw new Error(error.message);
    })
    .
        then(students = > [...students, postedStudent
    ])
    .
        catch(error = > {throw new Error(error.message);
    })
    .
        then(students = > fs_extra_1.default.writeFile(this.path, JSON.stringify(students))
    )
    .
        catch(error = > {throw new Error(error.message);
    })
        ;
    }

    deleteStudent(studentToDelete) {
        const id = studentToDelete.id;
        return this.getStudentById(id)
            .then(student = > {
            if(
        !student
    )
        throw new Error("student do not exist.");
    else
        return this._delete(studentToDelete);
    })
        ;
    }

    _save(student) {
        this.getAllStudents()
            .then(savedStudents = > savedStudents || []
    )
    .
        then(savedStudents = > {
            savedStudents.push(student);
        return savedStudents;
    })
    .
        then(savedStudents = > JSON.stringify(savedStudents)
    )
    .
        then(savedStudentsString = > fs_extra_1.default.writeFile(this.path, savedStudentsString)
    )
    .
        catch(error = > console.log(error)
    )
        ;
    }

    _delete(studentToDelete) {
        const id = studentToDelete.id;
        this.getAllStudents()
            .then(savedStudents = > savedStudents || []
    )
    .
        then(savedStudents = > {
            return savedStudents.filter(student = > student.id !== id
    )
        ;
    })
    .
        then(savedStudents = > JSON.stringify(savedStudents)
    )
    .
        then(savedStudentsString = > fs_extra_1.default.writeFile(this.path, savedStudentsString)
    )
    .
        catch(error = > console.log(error)
    )
        ;
    }
}

exports.default = JsonStudentRepository;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxhYXRjaFxcT25lRHJpdmVcXEJ1cmVhdVxcbm9kZV90czJcXHNyY1xccGVyc2lzdGVuY2VcXGpzb24tc3R1ZGVudC1yZXBvc2l0b3J5LnRzIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGFhdGNoXFxPbmVEcml2ZVxcQnVyZWF1XFxub2RlX3RzMlxcc3JjXFxwZXJzaXN0ZW5jZVxcanNvbi1zdHVkZW50LXJlcG9zaXRvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSx3REFBMEI7QUFLMUI7SUFFSSxZQUFZLE9BQWUsc0NBQXNDO1FBQzdELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxjQUFjO1FBQ1YsT0FBTyxrQkFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO2FBQzVCLEtBQUssQ0FBQyxDQUFDLEtBQVksRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRUQsY0FBYyxDQUFDLEVBQVU7UUFDckIsT0FBTyxJQUFJLENBQUMsY0FBYyxFQUFFO2FBQ3ZCLElBQUksQ0FBQyxDQUFDLFFBQW1CLEVBQUUsRUFBRSxDQUMxQixRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBZ0IsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFFRCxhQUFhLENBQUMsYUFBc0I7UUFDaEMsTUFBTSxFQUFFLEdBQUcsYUFBYSxDQUFDLEVBQUUsQ0FBQztRQUM1QixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO2FBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUNaLElBQUksT0FBTztnQkFBRSxNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7O2dCQUNuRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUE7UUFDekMsQ0FBQyxDQUFDLENBQUE7SUFDVixDQUFDO0lBRUQsYUFBYSxDQUFDLGFBQXNCO1FBQ2hDLE1BQU0sRUFBRSxHQUFHLGFBQWEsQ0FBQyxFQUFFLENBQUM7UUFDNUIsT0FBTyxJQUFJLENBQUMsY0FBYyxFQUFFO2FBQzNCLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNiLElBQUcsUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDO2dCQUFFLE9BQU8sUUFBUSxDQUFDOztnQkFDckMsTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUFBO1FBQ2xELENBQUMsQ0FBQzthQUNELEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO2FBQ2pELElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNiLElBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDO2dCQUFFLE9BQU8sQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7O2dCQUNyRyxNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUE7UUFDbkQsQ0FBQyxDQUFDO2FBQ0QsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUM7YUFDakQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLFFBQVEsRUFBRSxhQUFhLENBQUMsQ0FBQzthQUM5QyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsR0FBRSxNQUFNLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQzthQUNqRCxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxrQkFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQzthQUNuRSxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsR0FBRSxNQUFNLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFBO0lBRXRELENBQUM7SUFFRCxhQUFhLENBQUMsZUFBd0I7UUFDbEMsTUFBTSxFQUFFLEdBQUcsZUFBZSxDQUFDLEVBQUUsQ0FBQztRQUM5QixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO2FBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUNaLElBQUksQ0FBQyxPQUFPO2dCQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQzs7Z0JBQ2xELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUU5QyxDQUFDLENBQUMsQ0FBQTtJQUNWLENBQUM7SUFFRCxLQUFLLENBQUMsT0FBZ0I7UUFDbEIsSUFBSSxDQUFDLGNBQWMsRUFBRTthQUNoQixJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxhQUFhLElBQUksRUFBRSxDQUFDO2FBQzFDLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRTtZQUNsQixhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzVCLE9BQU8sYUFBYSxDQUFDO1FBQ3pCLENBQUMsQ0FBQzthQUNELElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUM7YUFDcEQsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxrQkFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLG1CQUFtQixDQUFDLENBQUM7YUFDekUsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQzNDLENBQUM7SUFFRCxPQUFPLENBQUMsZUFBd0I7UUFDNUIsTUFBTSxFQUFFLEdBQUcsZUFBZSxDQUFDLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsY0FBYyxFQUFFO2FBQ2hCLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLGFBQWEsSUFBSSxFQUFFLENBQUM7YUFDMUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFO1lBQ2xCLE9BQU8sYUFBYSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDO2FBQ0QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsQ0FBQzthQUNwRCxJQUFJLENBQUMsbUJBQW1CLENBQUMsRUFBRSxDQUFDLGtCQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLENBQUMsQ0FBQzthQUN6RSxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7SUFDM0MsQ0FBQztDQUNKO0FBL0VELHdDQStFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tICdmcy1leHRyYSc7XHJcbmltcG9ydCBTdHVkZW50UmVwb3NpdG9yeSBmcm9tICcuL3N0dWRlbnQtcmVwb3NpdG9yeSc7XHJcbmltcG9ydCBTdHVkZW50IGZyb20gXCIuL3N0dWRlbnRcIjtcclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBKc29uU3R1ZGVudFJlcG9zaXRvcnkgaW1wbGVtZW50cyBTdHVkZW50UmVwb3NpdG9yeSB7XHJcbiAgICBwcml2YXRlIHBhdGg6IHN0cmluZztcclxuICAgIGNvbnN0cnVjdG9yKHBhdGg6IHN0cmluZyA9ICcuL3NyYy9wZXJzaXN0ZW5jZS9kYXRhL3N0dWRlbnRzLmpzb24nKSB7XHJcbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRBbGxTdHVkZW50cygpOiBQcm9taXNlPFN0dWRlbnRbXT4ge1xyXG4gICAgICAgIHJldHVybiBmcy5yZWFkSnNvbih0aGlzLnBhdGgpXHJcbiAgICAgICAgLmNhdGNoKChlcnJvcjogRXJyb3IpID0+IGNvbnNvbGUubG9nKGVycm9yLm1lc3NhZ2UpKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTdHVkZW50QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdHVkZW50IHwgdW5kZWZpbmVkPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsU3R1ZGVudHMoKVxyXG4gICAgICAgICAgICAudGhlbigoc3R1ZGVudHM6IFN0dWRlbnRbXSkgPT5cclxuICAgICAgICAgICAgICAgIHN0dWRlbnRzLmZpbmQoKHN0dWRlbnQ6IFN0dWRlbnQpID0+IHN0dWRlbnQuaWQgPT09IGlkKSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlU3R1ZGVudChwb3N0ZWRTdHVkZW50OiBTdHVkZW50KSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSBwb3N0ZWRTdHVkZW50LmlkO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFN0dWRlbnRCeUlkKGlkKVxyXG4gICAgICAgICAgICAudGhlbihzdHVkZW50ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChzdHVkZW50KSB0aHJvdyBuZXcgRXJyb3IoXCJzdHVkZW50IGFscmVhZHkgZXhpc3RzLlwiKTtcclxuICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX3NhdmUocG9zdGVkU3R1ZGVudClcclxuICAgICAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVTdHVkZW50KHBvc3RlZFN0dWRlbnQ6IFN0dWRlbnQpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHBvc3RlZFN0dWRlbnQuaWQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsU3R1ZGVudHMoKVxyXG4gICAgICAgIC50aGVuKHN0dWRlbnRzID0+IHtcclxuICAgICAgICAgICAgaWYoc3R1ZGVudHMubGVuZ3RoICE9PSAwKSByZXR1cm4gc3R1ZGVudHM7XHJcbiAgICAgICAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKFwic3R1ZGVudHMgZG8gbm90IGV4aXN0LlwiKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IHt0aHJvdyBuZXcgRXJyb3IoZXJyb3IubWVzc2FnZSk7fSlcclxuICAgICAgICAudGhlbihzdHVkZW50cyA9PiB7XHJcbiAgICAgICAgICAgIGlmKHN0dWRlbnRzLnNvbWUoc3R1ZGVudCA9PiBzdHVkZW50LmlkID09PSBpZCkpIHJldHVybiBbLi4uc3R1ZGVudHMuZmlsdGVyKHN0dWRlbnQgPT4gc3R1ZGVudC5pZCAhPT0gaWQpXTtcclxuICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgRXJyb3IoXCJzdHVkZW50IGRvZXMgbm90IGV4aXN0LlwiKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IHt0aHJvdyBuZXcgRXJyb3IoZXJyb3IubWVzc2FnZSk7fSlcclxuICAgICAgICAudGhlbihzdHVkZW50cyA9PiBbLi4uc3R1ZGVudHMsIHBvc3RlZFN0dWRlbnRdKVxyXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7dGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UpO30pXHJcbiAgICAgICAgLnRoZW4oc3R1ZGVudHMgPT4gZnMud3JpdGVGaWxlKHRoaXMucGF0aCwgSlNPTi5zdHJpbmdpZnkoc3R1ZGVudHMpKSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge3Rocm93IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlKTt9KVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZVN0dWRlbnQoc3R1ZGVudFRvRGVsZXRlOiBTdHVkZW50KSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSBzdHVkZW50VG9EZWxldGUuaWQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3R1ZGVudEJ5SWQoaWQpXHJcbiAgICAgICAgICAgIC50aGVuKHN0dWRlbnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFzdHVkZW50KSB0aHJvdyBuZXcgRXJyb3IoXCJzdHVkZW50IGRvIG5vdCBleGlzdC5cIik7XHJcbiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9kZWxldGUoc3R1ZGVudFRvRGVsZXRlKTtcclxuXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgX3NhdmUoc3R1ZGVudDogU3R1ZGVudCkge1xyXG4gICAgICAgIHRoaXMuZ2V0QWxsU3R1ZGVudHMoKVxyXG4gICAgICAgICAgICAudGhlbihzYXZlZFN0dWRlbnRzID0+IHNhdmVkU3R1ZGVudHMgfHwgW10pXHJcbiAgICAgICAgICAgIC50aGVuKHNhdmVkU3R1ZGVudHMgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2F2ZWRTdHVkZW50cy5wdXNoKHN0dWRlbnQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNhdmVkU3R1ZGVudHM7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKHNhdmVkU3R1ZGVudHMgPT4gSlNPTi5zdHJpbmdpZnkoc2F2ZWRTdHVkZW50cykpXHJcbiAgICAgICAgICAgIC50aGVuKHNhdmVkU3R1ZGVudHNTdHJpbmcgPT4gZnMud3JpdGVGaWxlKHRoaXMucGF0aCwgc2F2ZWRTdHVkZW50c1N0cmluZykpXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmxvZyhlcnJvcikpXHJcbiAgICB9XHJcblxyXG4gICAgX2RlbGV0ZShzdHVkZW50VG9EZWxldGU6IFN0dWRlbnQpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHN0dWRlbnRUb0RlbGV0ZS5pZDtcclxuICAgICAgICB0aGlzLmdldEFsbFN0dWRlbnRzKClcclxuICAgICAgICAgICAgLnRoZW4oc2F2ZWRTdHVkZW50cyA9PiBzYXZlZFN0dWRlbnRzIHx8IFtdKVxyXG4gICAgICAgICAgICAudGhlbihzYXZlZFN0dWRlbnRzID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzYXZlZFN0dWRlbnRzLmZpbHRlcihzdHVkZW50ID0+IHN0dWRlbnQuaWQgIT09IGlkKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oc2F2ZWRTdHVkZW50cyA9PiBKU09OLnN0cmluZ2lmeShzYXZlZFN0dWRlbnRzKSlcclxuICAgICAgICAgICAgLnRoZW4oc2F2ZWRTdHVkZW50c1N0cmluZyA9PiBmcy53cml0ZUZpbGUodGhpcy5wYXRoLCBzYXZlZFN0dWRlbnRzU3RyaW5nKSlcclxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUubG9nKGVycm9yKSlcclxuICAgIH1cclxufSJdfQ==